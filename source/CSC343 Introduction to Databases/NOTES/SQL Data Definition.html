<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />

<title>SQL Data Definition - Notes Portal</title>

<link rel="icon" type="image/gif" href="https://lihd1003.github.io/assets/images/logo.png">
<link rel="stylesheet" href="https://lihd1003.github.io/assets/css/vendor.css" />
<link rel="stylesheet" href="https://lihd1003.github.io/assets/css/style.css" />
<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/98fa07784c.js"></script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="https://lihd1003.github.io/UofT-Course-Material-Repo/index/custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>
<body>
	<!-- header -->
   <header class="header-sticky header-dark">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="./index.html">
          <img class="navbar-logo navbar-logo-light" src="https://lihd1003.github.io/assets/images/logo.png" alt="Logo">
          <img class="navbar-logo navbar-logo-dark" src="https://lihd1003.github.io/assets/images/logo.png" alt="Logo">
        </a>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav align-items-center mr-auto">
          </ul>

          <ul class="navbar-nav align-items-center mr-0">
            <li class="nav-item">
              <a href="https://github.com/lihd1003" class="nav-link waves-effect waves-light" target="_blank">
                <i class="icon-github mr-2"></i>GitHub
              </a>
            </li>
            <li class="nav-item">
              <a href="https://github.com/lihd1003/UofT-Course-Material-Repo" class="nav-link waves-effect waves-light" target="_blank">
                <i class="icon-star mr-2"></i>Star the Repo
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

<section class="hero hero-with-header text-white" data-top-top="transform: translateY(0px);" data-top-bottom="transform: translateY(250px);">
    <div class="image image-overlay" style="background-image:url(https://lihd1003.github.io/assets/images/black.jpg)"></div>
    <div class="container">
      <div class="row align-items-center">
        <div class="col text-shadow">

          <h1 class="mb-0">SQL Data Definition</h1>
        </div>
      </div>
    </div>
 </section>
 <section class="bg-white sec" id="project">
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-the-type-of-each-attribute">Define the type of each attribute<a class="anchor-link" href="#Define-the-type-of-each-attribute">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Build-in-data-types">Build in data types<a class="anchor-link" href="#Build-in-data-types">&#182;</a></h4><p><code>CHAR(n)</code> fixed-length string of n char. Padd with blanks if necessary
<code>VARCHAR(n)</code> variable length string of up to n characters<br>
<code>TEXT</code> variable-length, unlimited (not SQL standard)<br>
<code>INT</code><br>
<code>FLOAT</code><br>
<code>BOOLEAN</code><br>
<code>DATA; TIME; TIMESTAMP</code></p>
<p><code>'string'</code> must be surround by single quotes</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="User-defined-types">User-defined types<a class="anchor-link" href="#User-defined-types">&#182;</a></h4><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">domain</span> <span class="n">Grade</span> <span class="k">AS</span> <span class="nb">int</span>
    <span class="k">default</span> <span class="k">null</span>
    <span class="k">check</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">);</span>

<span class="k">create</span> <span class="k">domain</span> <span class="n">Campus</span> <span class="k">as</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">default</span> <span class="s1">&#39;StG&#39;</span>
    <span class="k">check</span> <span class="p">(</span><span class="n">value</span> <span class="k">in</span> <span class="p">(</span><span class="s1">&#39;StG&#39;</span><span class="p">,</span> <span class="s1">&#39;UTM&#39;</span><span class="p">,</span> <span class="s1">&#39;UTSC&#39;</span><span class="p">))</span>
</pre></div>
<p>Constraints on a type are checked every time a value is assigned to an attribute of that type.</p>
<p>Fault value when no value has been specified.<br>
We can run a query and insert the resulting tuples into a relation even if the query does not give values for all the attributes in the relation if the types of the missing attributes have default values.</p>
<p>Table attributes can also have default values.</p>
<p>The difference</p>
<ul>
<li>attribute default: for that one attribute in that one table</li>
<li>type default: for every attribute defined to be of that type</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Keys-and-Foreign-Keys">Keys and Foreign Keys<a class="anchor-link" href="#Keys-and-Foreign-Keys">&#182;</a></h2><h4 id="key">key<a class="anchor-link" href="#key">&#182;</a></h4><p><code>PRIMARY KEY</code> for one or more attributes in a relation means</p>
<ul>
<li>the attributes form a key</li>
<li>their values will never be null</li>
</ul>
<p>Every table must have 0 or 1 primary key</p>
<p>example</p>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">T1</span> <span class="p">(</span>
    <span class="n">ID</span> <span class="nb">integer</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="p">);</span>

<span class="o">===</span>

<span class="o">#</span> <span class="k">only</span> <span class="n">way</span> <span class="k">for</span> <span class="n">multi</span><span class="o">-</span><span class="n">attribute</span> <span class="n">keys</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">Blah</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>unique</code> for one or more attributes</p>
<ul>
<li>form a key</li>
<li>value can be null (different from <code>primary key</code>)</li>
</ul>
<p>Can declare more than one set of attributes to be <code>unique</code></p>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">T1</span> <span class="p">(</span>
    <span class="n">ID</span> <span class="nb">integer</span> <span class="k">unique</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="p">);</span>

<span class="o">===</span>

<span class="o">#</span> <span class="k">only</span> <span class="n">way</span> <span class="k">for</span> <span class="n">multi</span><span class="o">-</span><span class="n">attribute</span> <span class="n">keys</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">Blah</span><span class="p">(</span>
    <span class="n">ID</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
    <span class="k">unique</span> <span class="p">(</span><span class="n">ID</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
<p>For uniqueness constraints, no two nulls are considered equal</p>
<ul>
<li>Set the attributes by unique, then you can't insert two <code>('A', 'B')</code>, but you can insert two <code>(null, 'B')</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="foreign-key">foreign key<a class="anchor-link" href="#foreign-key">&#182;</a></h4><div class="highlight"><pre><span></span><span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">sID</span><span class="p">)</span> <span class="k">references</span> <span class="n">Student</span>
</pre></div>
<p>every value for sID in this table must actually occur in the Student table and sID must be <code>primary key</code> or <code>unique</code></p>
<p>Can be declare with the attribute or as a separate table element.<br>
Can reference attributes that are not the primary key as long as they are unique; just name them</p>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">People</span> <span class="p">(</span>
    <span class="n">SIN</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">text</span><span class="p">,</span> 
    <span class="n">OHIP</span> <span class="nb">text</span> <span class="k">unique</span>
<span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">Volunteers</span> <span class="p">(</span>
    <span class="n">email</span> <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">OHIPnum</span> <span class="nb">text</span> <span class="k">references</span> <span class="n">People</span><span class="p">(</span><span class="n">OHIP</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Enforce-foreign-key-constraints">Enforce foreign-key constraints<a class="anchor-link" href="#Enforce-foreign-key-constraints">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&quot;check&quot;-constraints">"check" constraints<a class="anchor-link" href="#&quot;check&quot;-constraints">&#182;</a></h4><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">domain</span> <span class="n">Grade</span> <span class="k">as</span> <span class="nb">smallint</span>
    <span class="k">default</span> <span class="k">null</span>
    <span class="k">check</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
<p>define on attribute, tuples of a relation, and across relations.</p>
<p><strong>Attribute-based</strong></p>
<ul>
<li>Defined with a single attributes. constrains its value in every tuple</li>
<li>can only refer to that attribute</li>
<li>can include a subquery</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Student</span> <span class="p">(</span>
    <span class="n">sin</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">program</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">check</span> <span class="p">(</span><span class="n">program</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">post</span> <span class="k">from</span> <span class="n">O</span><span class="p">)),</span>
    <span class="n">firstName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre></div>
<p>checked only when insert a tuple, or update attribute value</p>
<p><code>not null</code> is very commonly used</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Tuple-based</strong></p>
<ul>
<li>defined as a separate element of the table schema, so can refer to any attributes of the table</li>
<li>The condition to be checked can be anything that could go in a <code>WHERE</code>, and can include a subquery</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Student</span> <span class="p">(</span>
    <span class="n">sID</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">age</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="k">year</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">college</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>

    <span class="k">check</span> <span class="p">(</span><span class="k">year</span> <span class="o">=</span> <span class="n">age</span> <span class="o">-</span> <span class="mi">18</span><span class="p">),</span>
    <span class="k">check</span> <span class="n">college</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">Collges</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
<p>Only when a tuple is inserted, or it updated</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>check</code> only fails if it evaluates to <code>false</code>, (different from <code>where</code> which only evaluates to <code>true</code>)</p>
<p>Problem with <code>null</code>, the only way to prevent <code>null</code> is <code>not null</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>name constraint</p>
<div class="highlight"><pre><span></span><span class="k">constraint</span> <span class="n">XXX</span> <span class="k">check</span> <span class="p">(...);</span>
<span class="k">constraint</span> <span class="n">XXX</span> <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">cNum</span><span class="p">,</span> <span class="n">dept</span><span class="p">)</span> <span class="k">references</span> <span class="n">Course</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Assertions">Assertions<a class="anchor-link" href="#Assertions">&#182;</a></h4><p><code>check</code> constraints apply to an attribute or table but they can't express constraints across tables</p>
<p><code>assertions</code> can express cross-table constraints
<code>create assertion (&lt;name&gt;) check (&lt;predicate&gt;);</code></p>
<p><code>assertions</code> are costly because they have to be checked upon every database update and each check can be expensive</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Triggers">Triggers<a class="anchor-link" href="#Triggers">&#182;</a></h4><p>cross-table constraints, as powerful as assertions, but can control the cost by having control over when they are applied</p>
<p>specify</p>
<ul>
<li>event: some type of database action <div class="highlight"><pre><span></span><span class="k">after</span> <span class="k">delete</span> <span class="k">on</span> <span class="n">Courses</span> 
<span class="o">#</span> <span class="k">or</span>
<span class="k">before</span> <span class="k">update</span> <span class="k">of</span> <span class="n">grade</span> <span class="k">on</span> <span class="n">Took</span>
</pre></div>
</li>
<li><p>condition: bool-valued expression</p>
<div class="highlight"><pre><span></span><span class="k">when</span> <span class="n">grade</span> <span class="o">&gt;</span> <span class="mi">95</span>
</pre></div>
</li>
<li><p>action: any SQL statements</p>
<div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">Winners</span> <span class="k">values</span> <span class="p">(</span><span class="n">sID</span><span class="p">)</span>
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reaction-Policies">Reaction Policies<a class="anchor-link" href="#Reaction-Policies">&#182;</a></h2><p><code>cascade</code> propagate the change to the referring table
<code>set null</code> set the referring attribute(s) to null</p>
<p>Suppose table R refers to table S<br>
We can define "fixes" that propagate changes backwards from S to R<br>
We cannot define fixes that propagate forward from R to S</p>
<p>Add your reaction policy where you specify the foreign key constraint</p>
<div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Took</span> <span class="p">(</span>
    <span class="p">...</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">sID</span><span class="p">)</span> <span class="k">references</span> <span class="n">Student</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span>
    <span class="p">...</span>
<span class="p">);</span>
</pre></div>
<p>You can react to ...</p>
<ul>
<li><code>on delete</code></li>
<li><code>on update</code></li>
<li>or both</li>
</ul>
<p>Policy can specify</p>
<ul>
<li><code>restrict</code>: Don't allow deletion/update</li>
<li><code>cascade</code>: make the same deletion/update in the referring tuple</li>
<li><code>set null</code>: Set the corresponding value in the referring tuple to <code>null</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-Schema">Update Schema<a class="anchor-link" href="#Update-Schema">&#182;</a></h2><ul>
<li>Alter: alter a domain or table</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">alter</span> <span class="k">table</span> <span class="n">Course</span>
    <span class="k">add</span> <span class="k">column</span> <span class="n">numSections</span> <span class="nb">int</span><span class="p">;</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">Course</span>
    <span class="k">drop</span> <span class="k">column</span> <span class="k">breadth</span><span class="p">;</span>
</pre></div>
<ul>
<li>Drop: remove a domain, table, or whole schema<div class="highlight"><pre><span></span><span class="k">drop</span> <span class="k">table</span> <span class="n">Course</span><span class="p">;</span>
<span class="o">#</span> <span class="n">Course</span> <span class="n">still</span> <span class="k">exists</span><span class="p">,</span> <span class="n">but</span> <span class="k">no</span> <span class="n">content</span> <span class="k">in</span> <span class="n">it</span>
</pre></div>
</li>
</ul>
<p>-Delete:</p>
<div class="highlight"><pre><span></span><span class="k">delete</span> <span class="k">from</span> <span class="n">Course</span>
<span class="o">#</span> <span class="n">Course</span> <span class="n">does</span> <span class="k">not</span> <span class="n">exist</span>
</pre></div>

</div>
</div>
</div>
    </div>
  </div>
</section>
  <script src="https://lihd1003.github.io/assets/js/vendor.js"></script>
  <script src="https://lihd1003.github.io/assets/js/app.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    $("table").addClass("table table-lined")
  </script>
</body>

 


</html>
