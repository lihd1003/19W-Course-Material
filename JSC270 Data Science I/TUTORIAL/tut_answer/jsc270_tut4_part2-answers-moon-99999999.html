<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />

<title>jsc270_tut4_part2-answers-moon-99999999 - Notes Portal</title>

<link rel="icon" type="image/gif" href="https://lihd1003.github.io/assets/images/logo.png">
<link rel="stylesheet" href="https://lihd1003.github.io/assets/css/vendor.css" />
<link rel="stylesheet" href="https://lihd1003.github.io/assets/css/style.css" />
<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/98fa07784c.js"></script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="https://lihd1003.github.io/UofT-Course-Material-Repo/table_of_content/custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>
<body>
	<!-- header -->
   <header class="header-sticky header-dark">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="./index.html">
          <img class="navbar-logo navbar-logo-light" src="https://lihd1003.github.io/assets/images/logo.png" alt="Logo">
          <img class="navbar-logo navbar-logo-dark" src="https://lihd1003.github.io/assets/images/logo.png" alt="Logo">
        </a>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav align-items-center mr-auto">
          </ul>

          <ul class="navbar-nav align-items-center mr-0">
            <li class="nav-item">
              <a href="https://github.com/lihd1003" class="nav-link waves-effect waves-light" target="_blank">
                <i class="icon-github mr-2"></i>GitHub
              </a>
            </li>
            <li class="nav-item">
              <a href="https://github.com/lihd1003/UofT-Course-Material-Repo" class="nav-link waves-effect waves-light" target="_blank">
                <i class="icon-star mr-2"></i>Star the Repo
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

<section class="hero hero-with-header text-white" data-top-top="transform: translateY(0px);" data-top-bottom="transform: translateY(250px);">
    <div class="image image-overlay" style="background-image:url(https://lihd1003.github.io/assets/images/black.jpg)"></div>
    <div class="container">
      <div class="row align-items-center">
        <div class="col text-shadow">

          <h1 class="mb-0">jsc270_tut4_part2-answers-moon-99999999</h1>
        </div>
      </div>
    </div>
 </section>
 <section class="bg-white sec" id="project">
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notes">Notes<a class="anchor-link" href="#Notes">&#182;</a></h2><hr>
<ul>
<li>Avoid hard-coding values when possible. You worked hard to scrape the data and save it to a dataframe. Use that dataframe in you code to retrieve values.</li>
</ul>
<p>*****<em><strong>Be aware of the difference between two-sided and one-sided tests</strong></em>*****</p>
<ul>
<li>ONLY use two-sided tests when the alternate hypothesis is in the form of $\mu\neq a$</li>
<li>Use one-sided test when the alternate hypothesis in the form of $\mu \ge a$ or $\mu \le a$</li>
<li>You can use two-sided tests for the case of testing $\mu \ge a$ or $\mu \le a$; think about the conclusions you can draw</li>
</ul>
<h3 id="Extra-tips/info">Extra tips/info<a class="anchor-link" href="#Extra-tips/info">&#182;</a></h3><ul>
<li>I found the permutation for contingency table (Question 2) quite slow using nested loops. Using <code>np.bincount</code> helped accelerate the task. Lesson <em>re</em>-learned: use built-in <code>numpy</code>/<code>scipy</code>/<code>panda</code> functions when possible.</li>
</ul>
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setup">Setup<a class="anchor-link" href="#Setup">&#182;</a></h3><p>Data collection steps adapted from Tutorial 2.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="c1"># reading data for Manitoba and New Brunswick</span>
<span class="c1"># url for the report page</span>
<span class="n">report_page</span> <span class="o">=</span> <span class="s1">&#39;https://www.canada.ca/en/public-health/services/&#39;</span> <span class="o">+</span> \
    <span class="s1">&#39;surveillance/respiratory-virus-detections-canada/&#39;</span> <span class="o">+</span> \
    <span class="s1">&#39;2018-2019/respiratory-virus-detections-isolations-&#39;</span> <span class="o">+</span> \
    <span class="s1">&#39;week-01-ending-january-5-2019.html&#39;</span>

<span class="c1"># using pandas `read_html` </span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">report_page</span><span class="p">)</span> <span class="c1"># returns a list of tables </span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># by inspection we see that Table 2 is the second table</span>

<span class="c1"># select. rows corresponding to prov and territory</span>
<span class="n">fludat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> 
    <span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> 
    <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span>
<span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span>
<span class="n">fludat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;prov&#39;</span><span class="p">,</span> <span class="s1">&#39;total_tested&#39;</span><span class="p">,</span>
    <span class="s1">&#39;H1N1_positive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;H3_positive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;other_positive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total_positive&#39;</span>
<span class="p">]</span>
<span class="n">fludat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">fludat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="c1"># Change province names so they match the names in the Wiki table</span>
<span class="c1"># `regex=True` allows you to use regular expressions</span>
<span class="n">fludat</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">fludat</span>
    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Province of&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Qu√©bec&#39;</span><span class="p">,</span> <span class="s1">&#39;Quebec&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># Alberta, Ontario, Quebec, Sask have extra white space </span>
<span class="c1"># in their names so remove</span>
<span class="n">fludat</span><span class="p">[</span><span class="s1">&#39;prov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fludat</span><span class="p">[</span><span class="s1">&#39;prov&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="c1"># table for question 1</span>
<span class="n">q1data</span> <span class="o">=</span> <span class="n">fludat</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;prov&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;New Brunswick&#39;</span><span class="p">,</span> <span class="s1">&#39;Manitoba&#39;</span><span class="p">]][[</span>
    <span class="s1">&#39;total_tested&#39;</span><span class="p">,</span> <span class="s1">&#39;total_positive&#39;</span>
<span class="p">]]</span>
<span class="n">q1data</span><span class="p">[</span><span class="s1">&#39;flu_A_negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">q1data</span><span class="p">[</span><span class="s1">&#39;total_tested&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">q1data</span><span class="p">[</span><span class="s1">&#39;total_positive&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># read wiki page from the web store the table</span>
<span class="n">wiki_page</span> <span class="o">=</span> <span class="s1">&#39;https://en.wikipedia.org/wiki/List_of_regions_of_Canada&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span>
    <span class="n">wiki_page</span><span class="p">,</span> 
    <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># since the html does not tag (&lt;th&gt;) </span>
              <span class="c1"># the first row as column, </span>
              <span class="c1"># you need to manually specify it</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;wikitable&quot;</span><span class="p">}</span> <span class="c1"># when you know specific html attributes </span>
                                  <span class="c1"># of the table you want you can specify </span>
                                  <span class="c1"># them here for a more specific query</span>
<span class="p">)</span>
<span class="c1"># read the six region columns and prov/territories</span>
<span class="n">regions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span>
    <span class="s1">&#39;All provinces and territories&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Six-region model[1]&#39;</span>
<span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
    <span class="c1"># propogate non-null values forward</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="c1"># rename columns</span>
    <span class="s2">&quot;All provinces and territories&quot;</span><span class="p">:</span> <span class="s2">&quot;prov&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;Six-region model[1]&quot;</span><span class="p">:</span> <span class="s2">&quot;region&quot;</span>
<span class="p">})</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="c1"># rename the province name to match the other table</span>
    <span class="p">[</span><span class="s1">&#39;Newfoundland and Labrador&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Newfoundland&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Merge regions with flu data and only keep required columns</span>
<span class="n">q2data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">fludat</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;prov&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Question-1">Question 1<a class="anchor-link" href="#Question-1">&#182;</a></h1><p>Use the influnenza data from tutorial 2 to answer the following questions.</p>
<p>Is the proportion of of influenza cases in Manitoba different compared to New Brunswick?</p>
<p>(a) Conduct a permutation test to evaluate this question. What are the assumptions behind this test? What is the P-value?  What do you conclude?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># create arrays for each province </span>
<span class="c1"># with positive cases coded as &#39;1&#39; </span>
<span class="c1"># and negative cases as &#39;0&#39;</span>
<span class="n">NB_cases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="c1"># positive cases for NB</span>
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># negative cases for NB</span>
<span class="p">))</span>
<span class="n">MB_cases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="c1"># positive cases for MB</span>
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># negative cases for MB</span>
<span class="p">))</span>
<span class="n">cases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
    <span class="n">NB_cases</span><span class="p">,</span> <span class="n">MB_cases</span>
<span class="p">))</span>
<span class="c1"># label provinces (length should match the total tested)</span>
<span class="n">provl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;NB&#39;</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="p">))</span>

<span class="c1"># sanity check (-:</span>
<span class="n">NB_obs_p</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cases</span><span class="p">[</span><span class="n">provl</span><span class="o">==</span><span class="s1">&#39;NB&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">MB_obs_p</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cases</span><span class="p">[</span><span class="n">provl</span><span class="o">==</span><span class="s1">&#39;MB&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">NB_obs_p</span> <span class="o">-</span> <span class="n">MB_obs_p</span> <span class="c1"># observed difference</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;NB sample prop:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">NB_obs_p</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;MB sample prop:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">MB_obs_p</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;Observed diff:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>NB sample prop:	 0.1775 
MB sample prop:	 0.1387 
Observed diff:	 0.0388
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Part (a)</span>
<span class="k">def</span> <span class="nf">prop_perm_test</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a single difference in proportion </span>
<span class="sd">    from a random suffle of cases</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shuffled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> 
    <span class="c1"># random.permutation returns the shuffled array </span>
    <span class="c1"># vs. random.shuffle shuffles the array inplace</span>
    <span class="n">prop_NB</span> <span class="o">=</span> <span class="n">shuffled</span><span class="p">[</span><span class="n">provl</span><span class="o">==</span><span class="s1">&#39;NB&#39;</span><span class="p">]</span>      
    <span class="n">prop_MB</span> <span class="o">=</span> <span class="n">shuffled</span><span class="p">[</span><span class="n">provl</span> <span class="o">==</span><span class="s1">&#39;MB&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">prop_NB</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">prop_MB</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">null_dist</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop_perm_test</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span> 

<span class="n">tbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">null_dist</span><span class="p">)</span>
<span class="n">p_value2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">null_dist</span> <span class="o">-</span> <span class="n">tbar</span><span class="p">)</span> 
    <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="n">tbar</span><span class="p">)</span>
<span class="p">)</span><span class="o">/</span><span class="n">N</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The two-sided p-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p_value2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># plot the distribution</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">null_dist</span><span class="p">,</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#e9a3c9&#39;</span><span class="p">,</span>
    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">observed</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">diff</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> 
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Difference in Proportions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Randomization Distribution of Proportion Differences&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The two-sided p-value is: 0.0
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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yfASRr44EoC169ZSMryEUS9HP8m55os1lAwvYcxr0c9irlyzkpLhJYybNg6A5Z8up2R4CY/MeASAJSuXbLT+8syaNYvvfe97G4zbdtttad++PevWrePVV1/lgQce4I033uD+++9nypQpPPnkk+y0007MmDGDmTNn0rt3b9auXctvfvMbxo4dy9SpUznxxBM3+FTw5ZdfMmXKFIYOHUrXrl159tlnAXj00Uc56KCDaNiwIYMGDeIf//gHU6dO5corr+T0008HYMiQIZx22mm8+eabtG7dumY7V0QyMXPhTGYu3Ki0FlxVum5GAr1zR5pZO6LfYpwfG30w0W+G7goMAm7KP8Xa68ADD6RFixZstdVWHHnkkbzwwgvstddejB8/nvPOO4/nn3+epk2bMnv2bGbOnMmBBx5I165dufzyyykt/eanTfv167fB8Jgx0RvW6NGj6devH6tWrWLy5Mn84he/oGvXrpxyyiksXrwYgBdffJFjjz0WgOOOOy7FrReRfJ3xrzM441/Jn+urtOvG3Z8zsw7lTLoa+D3wUGxcX+Auj37N5GUza2Zmrd19cb6Jxr9Q0LBBww0eN96y8QaPmzZuusHjltu03ODxjk13rFLMzp07M3bs2A3GffLJJ8yfP58GDRpsdNmimbHbbrsxbdo0Hn/8cS6++GJ69uzJEUccwZ577slLL71Ubpytt9766+HDDjuMCy+8kBUrVjB16lQOOOAAVq9eTbNmzZg+fXq5y+vySZG6afjRw1OJU6OTsWbWF1jo7jNyJrUh+nXzMqVhXHnrGGRmU8xsSm39Mk/Pnj1Zs2YNd911FwDr16/n7LPPZuDAgTRu3Jjx48ezYsUKPvvsM/7973+z3377sWjRIho3bsyAAQM499xzmTZtGp06dWLZsmVfF/q1a9cya9ascmM2adKE7t27M2TIEA499FDq16/PtttuS8eOHbn//vuB6CTxjBnRrt9vv/0YPXo0APfcc0/Su0RECqh7x+5079g98TjVLvRm1hi4EPhjPoHdfYS7d3P3bq1atcpnVYkxMx588EHuv/9+dt11V3bbbTcaNWrEFVdEZ8l79OjBUUcdxXe+8x2OOuoounXrxptvvkmPHj3o2rUrl156KRdffDFbbLEFY8eO5bzzzmPvvfema9euTJ48ucK4/fr1Y9SoURt06dxzzz3cdttt7L333uy555489FD0Qeraa6/lhhtuYK+99mLhwoXJ7hARKajp86czfX75n9QLqUq/GRu6bh519y5mthcwEVgTJrcFFgE9gEuBSe5+b1huNlBSWddNt27dfMqUKRuMe/vtt9ljjz2qtTFSsWLZn7rqRopJyfASIK973VSp37bal1e6+5vA9l9HMXsP6Obuy83sYeAMMxsNfB9YWYj+eRGRYnRNv2tSiVNpoTeze4ESoKWZlQJD3f22CmZ/HDgEmEPU4j+hQHmKiBSdru27phKnKlfdHFvJ9A6xYQcG55/W1+vTFSUFUJXuORFJ32vzXgNI/IRsrf1mbKNGjfjwww9p0aKFin0eyu5H36hRo6xTEZEc5449F9iM70fftm1bSktLdR/1Aij7hSkRqV2u/+X1qcSptYW+YcOG+kUkESlqXdp0SSWO7l4pIpKRyXMmM3lOxd+pKZRa26IXESl2Fz54IbAZ99GLiBS7fx73z1TiqNCLiGSk046dUomjPnoRkYw8O/tZnp39bOJx1KIXEcnI0IeHAuqjFxEpWrcPvD2VOCr0IiIZ2bnVzqnEUR+9iEhGJrw1gQlvTUg8jlr0IiIZufyxywHo1blXonFU6EVEMnL3SXenEkeFXkQkI+2at0sljvroRUQy8uTMJ3ly5pOJx1GLXkQkI8OeGAZA7y69E42jQi8ikpHRg0anEkeFXkQkIzs23TGVOOqjFxHJyCMzHuGRGY8kHqfSQm9mt5vZUjObGRs33MzeMbM3zOxBM2sWm3aBmc0xs9lmdlBSiYuI1HVXPXUVVz11VeJxqtKiHwnknikYD3Rx9+8A/wUuADCzzkB/YM+wzI1mVr9g2YqIFJGxp45l7KljE49TaaF39+eAFTnjnnL3deHhy0DZL0/3BUa7+xfuPg+YA/QoYL4iIkWj5TYtablNy8TjFKKP/kTgiTDcBlgQm1Yaxm3EzAaZ2RQzm7Js2bICpCEiUreMmzaOcdPGJR4nr0JvZhcB64B7qrusu49w927u3q1Vq1b5pCEiUiddN/E6rpt4XeJxanx5pZkNBA4Ferq7h9ELgfh3etuGcSIikuOhwQ+lEqdGLXoz6w38HjjM3dfEJj0M9DezLc2sI7Ar8Gr+aUpd4Ou/SnR+kWLTtHFTmjZumnicSlv0ZnYvUAK0NLNSYCjRVTZbAuPNDOBldz/V3WeZ2X3AW0RdOoPdfX1SyUvtYvXrsXRU1d/Xtx+g8/SyeRvz2hgA+nXvl2icSgu9ux9bzujbNjH/n4E/55OUbB58/VdYfX1nTzZfN026CagFhV4kKfoEIJu7x3/7eCpxVOhFRDLSeMvGqcTR52YRkYyMenkUo14elXgctehFRDJy6/O3AjBg3wGJxlGhFxHJyPjfjU8ljgq9iEhGGjZomEoc9dGLiGRk5IsjGfniyMTjqNCLiGRk5OSRjJw8MvE46roREcnIpHMnpRJHLXoRkSKnQi8ikpFbnruFW567JfE4KvRS1HRHTanNxkwZw5gpYxKPoz56KWq6n47UZhPOmpBKHLXoRUSKnAq9VEjdGCLJuvGZG7nxmRsTj6OuG6mQuj1EkvXIG48AcPpPT080jgq9iEhGnhjyRCpx1HUjEqOrdKQYqUUvEqPuKknTtROuBWBIryGJxlGLXkQkIxPfmcjEdyYmHqfSFr2Z3Q4cCix19y5hXHNgDNABeA84xt0/MjMDrgUOAdYAA919WjKpi4jUbQ+f8XAqcarSoh8J9M4Zdz4w0d13BSaGxwAHA7uGv0HATYVJU0REaqrSQu/uzwErckb3Be4Mw3cCh8fG3+WRl4FmZta6UMmKiBSTK/9zJVf+58rE49T0ZOwO7r44DC8BdgjDbYAFsflKw7jF5DCzQUStftq3b1/DNERE6q6X5r6USpy8r7pxdzczr8FyI4ARAN26dav28iIidd0Dpz2QSpyaXnXzQVmXTPi/NIxfCLSLzdc2jBMRkYzUtNA/DBwfho8HHoqN/7VF9gVWxrp4REQkZtgTwxj2xLDE41Tl8sp7gRKgpZmVAkOBYcB9ZnYS8D5wTJj9caJLK+cQXV55QgI5i4gUhekLpqcSp9JC7+7HVjCpZznzOjA436RERDYHoweNTiWOvhkrIlLkVOhFRDJy2aOXcdmjlyUeRzc1ExHJyOwls1OJo0IvIpKRUSePSiWOum5ERIqcCr2ISEb++NAf+eNDf0w8jrpuREQysmDFgspnKgAVehGRjNxxwh2pxFHXjYhIkVOhFxHJyAXjLuCCcRckHkddNyIiGflw1YepxFGhFxHJyIhfj0gljrpuRESKnAq9iEhGzrn/HM65/5zE46jrRkQkI599+VkqcVToRUQycsOvbkgljrpuRESKnAq9iEhGzhx9JmeOPjPxOCr0IiJFTn30IiIZuab/NanEyatFb2a/M7NZZjbTzO41s0Zm1tHMXjGzOWY2xsy2KFSyIiJSfTUu9GbWBvgt0M3duwD1gf7AX4Gr3X0X4CPgpEIkKiJSbAbfM5jB9wxOPE6+ffQNgK3MrAHQGFgMHACMDdPvBA7PM4aISFHaaout2GqLrRKPU+M+endfaGZXAvOBz4CngKnAx+6+LsxWCrQpb3kzGwQMAmjfvn1N0xARqbOu/MWVqcTJp+tmO6Av0BHYCdga6F3V5d19hLt3c/durVq1qmkaIiJSiXy6bnoB89x9mbuvBcYB+wHNQlcOQFtgYZ45iogUpUF3DWLQXYMSj5NPoZ8P7Gtmjc3MgJ7AW8AzwNFhnuOBh/JLUUSkOLVo0oIWTVokHiefPvpXzGwsMA1YB7wOjAAeA0ab2eVh3G2FSFREpNj85ci/pBInry9MuftQYGjO6LlAj3zWKyIihaNbIIiIZOSEO07ghDtOSDyOboEgIpKRds3bpRJHhV5EJCN/6vunVOKo60ZEpMip0IuIZGTArQMYcOuAxOOo60ZEJCOdduyUShwVehGRjPzh0D+kEkddNyIiRU6FXkQkI/1H9Kf/iP6Jx1HXjYhIRrq265pKHBV6EZGMnH/w+anEUdeNiEiRU6EXEcnIUTcdxVE3HZV4HHXdiIhk5Ac7/yCVOCr0IiIZOeegc1KJo64bEZEip0IvIpKRw64/jMOuPyzxOOq6ERHJSM/de6YSR4VeRCQjQ3oNSSVOXl03ZtbMzMaa2Ttm9raZ/cDMmpvZeDN7N/zfrlDJiohI9eXbR38t8KS77w7sDbwNnA9MdPddgYnhsYiI5Dj42oM5+NqDE49T464bM2sK/BgYCODuXwJfmllfoCTMdicwCTgvnyRFRIpRn+/0SSVOPn30HYFlwB1mtjcwFRgC7ODui8M8S4Ad8ktRRKQ4nf7T01OJk0/XTQPgu8BN7r4PsJqcbhp3d8DLW9jMBpnZFDObsmzZsjzSEBGRTcmn0JcCpe7+Sng8lqjwf2BmrQHC/6XlLezuI9y9m7t3a9WqVR5piIjUTb3+3otef++VeJwad924+xIzW2Bmndx9NtATeCv8HQ8MC/8fKkimIiJFpl+3fqnEyfc6+t8A95jZFsBc4ASiTwn3mdlJwPvAMXnGEBEpSv/34/9LJU5ehd7dpwPdypmUzte9RESkUrrXzWbC13+VdQoikqNkeAklw0sSj6NbIGwmrH49lo56tVrLbD+gR0LZiAjAwB8OTCWOCr2ISEYG7jcwlTjquhERycjadWtZu25t4nHUohcRyciBVx8IwKRzJyUaR4W+jvL1X2H19YEsazV5HvTcSZmT9z85lTgq9HVUdU+u6sRqMnSSW/IxYN8BqcRRs0JEJCNrvljDmi/WJB5HLXoRkYwcct0hgProRUSK1mklp6USR4VeRCQj/bqnc1Mz9dGLiGRk5ZqVrFyzMvE4atGLiGSk7w19AfXRi4gUrd/2/G0qcVToRUQycuR3j0wljvroRUQysvzT5Sz/dHnicdSiFxHJyNE3Hw2oj15EpGid/bOzU4mjQi8ikpE+e/dJJY766EVEMrJk5RKWrFySeJy8C72Z1Tez183s0fC4o5m9YmZzzGyMmW2Rf5oiIsWn/4j+9B/RP/E4hei6GQK8DWwbHv8VuNrdR5vZzcBJwE0FiCMiUlTOP/j8VOLk1aI3s7bAz4Fbw2MDDgDGhlnuBA7PJ4aISLHq3aU3vbv0TjxOvl031wC/B74Kj1sAH7v7uvC4FGhT3oJmNsjMppjZlGXLluWZhohI3bNgxQIWrFiQeJwaF3ozOxRY6u5Ta7K8u49w927u3q1Vq1Y1TUNEpM467rbjOO624xKPk08f/X7AYWZ2CNCIqI/+WqCZmTUIrfq2wML80xQRKT4X//ziVOLUuEXv7he4e1t37wD0B552918BzwBHh9mOBx7KO0sRkSLUq3MvenXulXicJK6jPw84y8zmEPXZ35ZADBGROm/usrnMXTY38TgF+Wasu08CJoXhuYB+5l6kAr7+K6x+1dtY1Z1f6o4TR54I6F43mw29mDcfVr8eS0e9WuX5tx+gdlOxuvSwS1OJo0JfS+jFL7L5+Umnn6QSR01IEZGMzF4ym9lLZiceRy16EZGMnHL3KYD66EVEitYVR1yRShwVehGRjPxwlx+mEkd99CIiGZm5cCYzF85MPI5a9CIiGTnjX2cA6qMXESlaw48enkocFXoRkYx079g9lTjqoxcRycj0+dOZPn964nHUohcRyciZY84E1EcvIlK0rul3TSpxVOhFajnd7bJ4dW3fNZU4KvQitZxueFe8Xpv3GpD8SVkVehGRjJw79lxAffQiIkXr+l9en0ocFXoRkYx0adMllTg6YyMikpHJcyYzec7kxOOoRS8ikpELH7wQqMV99GbWDrgL2AFwYIS7X2tmzYExQAfgPeAYd/8o/1RFRIrLP4/7Zypx8um6WQec7e6dgX2BwWbWGTgfmOjuuwITw2MREcnRacdOdNqxU+Jxalzo3X2xu08Lw58CbwNtgL7AnWG2O4HD801SRKQYPTv7WZ6d/WzicQrSR29mHYB9gFeAHdx9cZi0hKhrp7xlBgGDANq3b1+INERE6pShDw8FanEffRkzawI8AJzp7p+Y2dfT3N3NzMtbzt1HACMAunXrVu48IiLF7PaBt6cSJ69Cb2YNiYr8Pe4+Loz+wMxau/tiM2sNLM03SRHQMe0dAAALX0lEQVSRYrRzq51TiVPjPnqLmu63AW+7+99jkx4Gjg/DxwMP1Tw9EZHiNeGtCUx4a0LicfJp0e8HHAe8aWZld86/EBgG3GdmJwHvA8fkl6KISHG6/LHLAejVuVeicWpc6N39BcAqmNyzpusVEdlc3H3S3anE0TdjE6D7gYtIVbRr3i6VOCr0Caju/cNB9xAX2Rw9OfNJAHp36Z1oHBV6EZGMDHtiGKBCLyJStEYPGp1KHBV6EZGM7Nh0x1Ti6IyhiEhGHpnxCI/MeCTxOGrRixSZmlz1pSvFsnHVU1cB0GfvPonGUaEXKTK66qvuGHvq2FTiqNCLiGSk5TYtU4mjz2oiIhkZN20c46aNq3zGPKlFLyKSkesmXgfAkd89MtE4KvQiIhl5aHA6N/dVoRcRyUjTxk1TiaM+ehGRjIx5bQxjXhuTeBy16EVEMnLTpJsA6Ne9X6JxVOhFRDLy+G8fTyWOCr2ISEYab9k4lTjqoxcRyciol0cx6uVRicep84Xe13+VyjIixay6rwm9hgrj1udv5dbnb008Tp3vutF9PUTyV93XkV5DhTH+d+NTiZNYi97MepvZbDObY2bnJxWnJqrdelmn1otInD4BFEbDBg1p2KBh4nESadGbWX3gBuBAoBR4zcwedve3kohXXTVpvai1I/KN6r6GWh3brVrr31xumzzyxZEADNxvYKJxkuq66QHMcfe5AGY2GugL1IpCLyLpUtdQ+UZOHgkkX+jN3Qu/UrOjgd7ufnJ4fBzwfXc/IzbPIGBQeNgJmF3wRAqnJbA86yRqqC7nDso/S3U5d6jb+Vc19+XuXukvi2d2MtbdRwAjsopfHWY2xd2r99mzlqjLuYPyz1Jdzh3qdv6Fzj2pTrCFQLvY47ZhnIiIpCypQv8asKuZdTSzLYD+wMMJxRIRkU1IpOvG3deZ2RnAf4D6wO3uPiuJWCmpE11MFajLuYPyz1Jdzh3qdv4FzT2Rk7EiIlJ7FP+FqiIimzkVehGRIqdCH5hZczMbb2bvhv/bVTDf8WGed83s+DCusZk9ZmbvmNksMxtWV3IP4/9sZgvMbFV6WVd+mwwz29LMxoTpr5hZh9i0C8L42WZ2UJp5h/g1yt3MWpjZM2a2ysyuTzvvWH41zf9AM5tqZm+G/wfUodx7mNn08DfDzI5IO/eQR42P+zC9fTh+zqlyUHfXX3Se4m/A+WH4fOCv5czTHJgb/m8XhrcDGgM/DfNsATwPHFwXcg/T9gVaA6tSzLk+8D9g57DPZgCdc+Y5Hbg5DPcHxoThzmH+LYGOYT3160juWwM/Ak4Frk/7OC9A/vsAO4XhLsDCOpR7Y6BBGG4NLC17XBfyj00fC9wPnFPVuGrRf6MvcGcYvhM4vJx5DgLGu/sKd/8IGE/0DeA17v4MgLt/CUwj+u5AWmqcO4C7v+zui1PJ9Btf3yYj7LOy22TExbdrLNDTzCyMH+3uX7j7PGBOWF9aapy7u6929xeAz9NLdyP55P+6uy8K42cBW5nZlqlkHckn9zXuvi6MbwRkcSVKPsc9ZnY4MI9o31eZCv03dogVuyXADuXM0wZYEHtcGsZ9zcyaAX2AiUkkWYGC5J6yquTz9TzhBboSaFHFZZOUT+61QaHyPwqY5u5fJJRnefLK3cy+b2azgDeBU2OFPy01zt/MmgDnAZdWN2idvx99dZjZBGDHciZdFH/g7m5m1X63N7MGwL3AdR5u6FYoSecuUh1mtifwV+BnWedSHe7+CrCnme0B3GlmT7h7lp+uquMS4Gp3XxUa+FW2WRV6d+9V0TQz+8DMWrv7YjMr67/LtRAoiT1uC0yKPR4BvOvu1xQg3Q2kkHvaqnKbjLJ5SsObaFPgwyoum6R8cq8N8srfzNoCDwK/dvf/JZ9uuXmVqdG+d/e3w8UHXYApyaW7kXzy/z5wtJn9DWgGfGVmn7t75Sf10zwRUZv/gOFseELzb+XM05yof2y78DcPaB6mXQ48ANSra7nH5knzZGwDohPCHfnmpNSeOfMMZsOTUveF4T3Z8GTsXNI9GVvj3GPTB5Ldydh89n2zMP+RdTD3jnxzMvZbwCKgZV3JP2eeS6jGydjUn6ja+kfUhzcReBeYECvg3YBbY/OdSHTybw5wQhjXlujEztvA9PB3cl3IPYz/G1Ff4Vfh/yUp5X0I8F+iqxAuCuP+BBwWhhsRXV0wB3gV2Dm27EVhudmkeIVTgXJ/D1gBrAr7u3NdyR+4GFgdO86nA9vXkdyPIzqJOZ3ogonD097v+R47sXVcQjUKvW6BICJS5HTVjYhIkVOhFxEpcir0IiJFToVeRKTIqdCLiBQ5FXqpMjNbH+78Nyvc/e9sM6sXpnUzs+vC8JZmNiHM28/M9g/LTDezrbLdivKZ2Z/MrMIvpZUzf4mZrQzb9LaZDU0yvwpyONPMGscePx5uwSGyAV1eKVVmZqvcvUkY3h74F/Ciuw/NmW9f4HIP3+Y1s5uBF9x9VBXjGNGx+VVBN6CAzKyE6DrmQ81sa6Jrs/u5+7TYPA08oXupmFnZXRC7ufvyJGJI8VCLXmrE3ZcCg4AzLFJiZo+GN4BRQPfQ2j0FOAa4zMzuATCzc83sNTN7w8wuDeM6hHt03wXMBNqZ2c/M7CUzm2Zm94ebOmFm75nZpWH8m2a2exjfxMzuCOPeMLOjwvhy1xNnZiPN7OhNrX8T+2I1MBXYxcwGmtnDZvY0MDHsm+FmNjOsq1+IUWJmz1n0Owazzezm2KejY8O8M83sr7EcV5nZVWY2g+gLYzsBz5jZM7G8W4bhs8LyM83szNg+ftvMbgmfsJ4q+4RlZr81s7fCfhtdvaNBar0svhmmv7r5Rzm3SAA+JrpbZgnwaBj39XB4PBI4Ogz/jOieQEbU0HgU+DHQgeibufuG+VoCzwFbh8fnAX8Mw+8BvwnDpxO+/Ut0k61rYnG329R6crYjnmO568+ZP769LcIyexLd2qCUb76dfBTRLaHrh/00n+he6CVEtyreOUwbDxxNVLznA62Ivi7/NOEbnETfvj4mlsN7xL7CX/YY+B7R3Rm3BpoQfRt0n7CP1wFdw/z3AQPC8CJgyzDcLOtjTX+F/dusbmomtcLPwt/r4XETYFei4va+u78cxu9L9AMjL0Y9OWwBvBRbz7jwfypwZBjuRXRvEADc/SMzO7SS9VSkvPXn2t/MXid6gxrm7rPMrDvhvv9hnh8B97r7euADM3sW6A58Arzq4S6nZnZvmHctMMndl4Xx9xC9Ef4bWE90P6XK/Ah40KNPGpjZOGB/4GFgnrtPj21bhzD8BnCPmf07xJIiokIvNWZmOxMVn6XAHlVdDPiLu/8zZ10diO6hEp9vvLsfW8F6yu6Bvp5NH8eVraciVVn/8+5+aDnjV5czrjy5J8gqO2H2eXjDyEf83vHrgbKT4z8nekPpA1xkZnt5+vdql4Soj15qxMxaATcT3YGxOmf0/wOcGOtvbxP69XO9DOxnZruE+bY2s90qWfd4ojv/leW4XQ3XU0jPA/3MrH7YZz8mulEVQA8z6xj65vsBL4RpPzGzluGE67HAsxWs+1NgmwpiHm7RbxlvDRwRxpUrxG/n0a+knUd0W9yNzmNI3aUWvVTHVmY2HWhI1Nd7N/D36qzA3Z+y6EcfXgpdKauAAUSty/h8y8xsIHCvffNTdRcT3fWvIpcDN5jZzLC+S919XA3WU0gPAj8guh2tA7939yXhBO9rwPXALsAzRN0tX1n0g9HPEH0aeczdH6pg3SOAJ81skbv/tGyku08zs5F884Zyq7u/bjk/Mh1THxhlZk1DzOvc/eMab7HUOrq8UiQDFrs8M+tcpPip60ZEpMipRS8iUuTUohcRKXIq9CIiRU6FXkSkyKnQi4gUORV6EZEi9/91Q46MNAIj3wAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(b) Conduct a Z-test to evaluate this question.  What are the assumptions behind this test? What is the P-value?  What do you conclude?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Part (b)</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="k">import</span> <span class="n">proportions_ztest</span>

<span class="n">nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span> <span class="c1">#n_1, n_2</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">q1data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span> <span class="c1">#X_1, X_2</span>

<span class="n">obsZ</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span>
    <span class="n">count</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The observed Z-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">obsZ</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The two-sided p-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The observed Z-value is: 5.102
The two-sided p-value is: 0.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Assumptions">Assumptions<a class="anchor-link" href="#Assumptions">&#182;</a></h4><p>For both tests, we assume the flu test result for each individual within each province are independent and identically distributed - i.e., exchangeable between individuals for permutation test. The proportional Z-test further assumes they are from binomial distributions.</p>
<h4 id="Interpretation">Interpretation<a class="anchor-link" href="#Interpretation">&#182;</a></h4><p>The reported p-values are <code>0.0</code> for both tests and the null hypothesis is rejected based on 95% confidence level. That is, we conclude that the two proportions are different (in fact, we may conclude NB has higher proportion than Manitoba) 19 out of 20 times.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Question-2">Question 2<a class="anchor-link" href="#Question-2">&#182;</a></h1><p>In class 5 we discussed this example.</p>
$$\begin{align*}
H_0 &amp;: \text{region and and subtype of influenza are independent,} \\ 
H_a &amp;: \text{region and subtype of influenza are dependent}.
\end{align*}$$<p>(a) Write a Python program to calculate the permutation distribution to test of independence of region and subtype of influenza. Create an appropriate visualization of this distribution.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Part (a)</span>
<span class="kn">from</span> <span class="nn">scipy.stats.contingency</span> <span class="k">import</span> <span class="n">expected_freq</span>
<span class="n">fludat_region</span> <span class="o">=</span> <span class="n">q2data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Observed contingency table.&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fludat_region</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">expected_freq</span><span class="p">(</span><span class="n">fludat_region</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expected contingency table.&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">fludat_region</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="n">fludat_region</span><span class="o">.</span><span class="n">index</span>
<span class="p">))</span>

<span class="k">def</span> <span class="nf">get_chisq_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return the value test statistic value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_freq</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="nb">pow</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">expected</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">expected</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># print observed test statistic</span>
<span class="n">observed_chisq</span> <span class="o">=</span> <span class="n">get_chisq_test</span><span class="p">(</span><span class="n">fludat_region</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;Observed test statistic:&#39;</span><span class="p">,</span> 
    <span class="nb">round</span><span class="p">(</span><span class="n">observed_chisq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Observed contingency table.
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>H1N1_positive</th>
      <th>H3_positive</th>
      <th>other_positive</th>
    </tr>
    <tr>
      <th>region</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Atlantic</th>
      <td>81</td>
      <td>1</td>
      <td>880</td>
    </tr>
    <tr>
      <th>British Columbia</th>
      <td>1010</td>
      <td>75</td>
      <td>755</td>
    </tr>
    <tr>
      <th>Ontario</th>
      <td>752</td>
      <td>180</td>
      <td>546</td>
    </tr>
    <tr>
      <th>Prairies</th>
      <td>4604</td>
      <td>136</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>Quebec</th>
      <td>0</td>
      <td>0</td>
      <td>5974</td>
    </tr>
    <tr>
      <th>Territories</th>
      <td>162</td>
      <td>3</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Expected contingency table.
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>H1N1_positive</th>
      <th>H3_positive</th>
      <th>other_positive</th>
    </tr>
    <tr>
      <th>region</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Atlantic</th>
      <td>354</td>
      <td>21</td>
      <td>586</td>
    </tr>
    <tr>
      <th>British Columbia</th>
      <td>678</td>
      <td>41</td>
      <td>1122</td>
    </tr>
    <tr>
      <th>Ontario</th>
      <td>544</td>
      <td>33</td>
      <td>901</td>
    </tr>
    <tr>
      <th>Prairies</th>
      <td>2768</td>
      <td>165</td>
      <td>4581</td>
    </tr>
    <tr>
      <th>Quebec</th>
      <td>2201</td>
      <td>132</td>
      <td>3642</td>
    </tr>
    <tr>
      <th>Territories</th>
      <td>63</td>
      <td>4</td>
      <td>104</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Observed test statistic: 7584.81
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># permutation distribution of the test statistic</span>
<span class="k">def</span> <span class="nf">chisq_perm_shuffle</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">array2</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a single value of chi squared test statistic</span>
<span class="sd">    from a single random shuffle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># shuffle</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
    <span class="c1"># count</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">array2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">array1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">arr1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array1</span><span class="p">):</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">array2</span><span class="p">[</span><span class="n">array1</span><span class="o">==</span><span class="n">arr1</span><span class="p">])</span>
        <span class="n">counts</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span> <span class="n">arr1</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span> <span class="c1"># in case there is no region 5 </span>
                                        <span class="c1"># (the lengths would differ)</span>
    <span class="k">return</span> <span class="n">get_chisq_test</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
    
    
<span class="k">def</span> <span class="nf">chisq_perm_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a list of chi squared test statistics</span>
<span class="sd">    from random suffles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create array of 0,1,2 for subtypes</span>
    <span class="n">cases_by_subtype</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">sub_positive</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)):</span>
        <span class="n">cases_by_subtype</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">sub_positive</span><span class="p">))</span>
    <span class="n">cases_by_subtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cases_by_subtype</span><span class="p">)</span>
    <span class="c1"># create array of 0,1,...,5 for regions</span>
    <span class="n">cases_by_region</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">reg_positive</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">cases_by_region</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">reg_positive</span><span class="p">))</span>
    <span class="n">cases_by_region</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cases_by_region</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">chisq_perm_shuffle</span><span class="p">(</span>
            <span class="n">cases_by_subtype</span><span class="p">,</span>
            <span class="n">cases_by_region</span><span class="p">,</span> 
            <span class="n">expected</span>
        <span class="p">)</span> 
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="p">]</span>

<span class="c1"># randomly pemutate for N=1000 iterations</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">null_dist_2</span> <span class="o">=</span> <span class="n">chisq_perm_test</span><span class="p">(</span><span class="n">fludat_region</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plot the distribution</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">null_dist_2</span><span class="p">,</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#e9a3c9&#39;</span><span class="p">,</span>
    <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Chi-squared Test Statistic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Permutation Distribution of Region &#39;</span><span class="o">+</span>
          <span class="s1">&#39;and Influenza Test of Independence&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(b) Use the permutation distribution in (a) calculate the p-value of the test.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Part (b)</span>
<span class="n">p_value2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
    <span class="p">(</span><span class="n">null_dist_2</span><span class="p">)</span>
        <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">observed_chisq</span><span class="p">)</span>
<span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The p-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p_value2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The p-value is: 0.001
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(c) What can you conclude about region and subtype of influenza based on the results in part (b)?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Answer-for-Q2c">Answer for Q2c<a class="anchor-link" href="#Answer-for-Q2c">&#182;</a></h3><p>With p-value &lt; <code>0.05</code>, the null hypothesis is rejected at 95% confidence level. In words, we conclude that the distribution of subtypes among positive influenza cases is not independent of the regions 19 out of 20 times.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Question-3">Question 3<a class="anchor-link" href="#Question-3">&#182;</a></h1><p>This question involves investigating type I and II error rates for testing two proportions.</p>
<p>(a) Explain how to simulate the type I error rate for a Z-test of two proportions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Answer-for-Q3a">Answer for Q3a<a class="anchor-link" href="#Answer-for-Q3a">&#182;</a></h3><ol>
<li>Simulate two independent sequence of <code>n</code> Bernoulli random variables from a common Bernoulli distribution.</li>
<li>Perform Z-test and calculate the p-value based on a confidence level, <code>alpha</code>.</li>
<li>Repeat <code>N</code> times and calculate proportion of times the p-value is less than <code>alpha</code>.</li>
</ol>
<p>The simulation gives the proportion of time the null hypothesis (<code>p1=p2</code>) is rejected under null hypothesis (Type I error).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(b) Write a program in Python to simulate the type I error rate of the Z-test for two proportions.  What is your type I error rate for your simulation?  Assume the sample size in each group is 200 and $\alpha=0.05$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">bernoulli</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span> <span class="c1">#set random seed for replicability</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1"># alpha</span>
<span class="n">p1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Probability for population 1</span>
<span class="n">p2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Probability for population 2</span>

<span class="n">nsamples</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">#each test will use nsamples</span>
<span class="n">nsims</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1">#number of simulations from which to draw average</span>

<span class="k">def</span> <span class="nf">sim_prop_test</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">):</span>
    <span class="n">testA</span> <span class="o">=</span> <span class="n">bernoulli</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
    <span class="n">testB</span> <span class="o">=</span> <span class="n">bernoulli</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">testA</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">testB</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">])</span>
    <span class="n">rejected</span> <span class="o">=</span> <span class="p">(</span><span class="n">proportions_ztest</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">nobs</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rejected</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;The simulated type I error rate is&#39;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span>
        <span class="n">sim_prop_test</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsims</span><span class="p">)</span>
    <span class="p">]),</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The simulated type I error rate is 0.044.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(c) Explain how to simulate the power for testing two proportions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Answer-for-Q3c">Answer for Q3c<a class="anchor-link" href="#Answer-for-Q3c">&#182;</a></h3><ol>
<li>Simulate two independent sequence of <code>n</code> Bernoulli random variables from two different Bernoulli distributions.</li>
<li>Perform Z-test and calculate the p-value based on a confidence level, <code>alpha</code>.</li>
<li>Repeat <code>N</code> times and calculate proportion of times the p-value is less than <code>alpha</code>.</li>
</ol>
<p>The simulation gives the proportion of time the null hypothesis (<code>p1=p2</code>) is rejected under alternate hypothesis.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(d) Write a program in Python to simulate the power of the Z-test for two proportions. What is the power and type II error rate for your simulation? Assume the sample size in each group is 200, $\alpha=0.05$, and the true proportion in one group is 0.45 and the true proportion in the other group is 0.57.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="c1"># Probability for population 1</span>
<span class="n">p2</span> <span class="o">=</span> <span class="mf">0.57</span> <span class="c1"># Probability for population 2</span>

<span class="n">rejected</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">sim_prop_test</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsims</span><span class="p">)</span>
    <span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;The simulated power is&#39;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rejected</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;The simulated power is&#39;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rejected</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The simulated power is 0.687.
The simulated power is 0.313.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Question-4">Question 4<a class="anchor-link" href="#Question-4">&#182;</a></h1><p>Let $X$ be the number of purchases from and $n$ the number of visitors to the website.  The website owner is testing two versions of a web page on her site.  In a one-week period: 1874 visitors were randomized to page A, and 52 visitors made a purchase; and 1871 visitors were randomized to page B and 55 made a purchase.</p>
<p>(a) Assume that the probability of a purchase is uniformly distributed.  Calculate the probability that the proportion of visitors to page B that make a purchase is greater than the proportion of visitors to page A.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">nsim</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">purchased_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span>
    <span class="mi">52</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1874</span><span class="o">-</span><span class="mi">52</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nsim</span><span class="p">)</span> <span class="c1"># page A posterior dist</span>
<span class="n">purchased_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span>
    <span class="mi">55</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1871</span><span class="o">-</span><span class="mi">55</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nsim</span><span class="p">)</span> <span class="c1"># page B posterior dist</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The estimated probability is&#39;</span><span class="p">,</span>
      <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
          <span class="nb">sum</span><span class="p">(</span><span class="n">purchased_B</span> <span class="o">&gt;</span> <span class="n">purchased_A</span><span class="p">)</span><span class="o">/</span><span class="n">nsim</span><span class="p">,</span> <span class="c1"># prob pB &gt; pA</span>
      <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The estimated probability is 0.62.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>(b) Compare your result in (a) to a statistical hypothesis test.  Which test is more informative? Briefly explain.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area border">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">52</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span>
<span class="n">nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1874</span><span class="p">,</span> <span class="mi">1871</span><span class="p">])</span>
<span class="n">obsZ</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span>
    <span class="n">count</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The observed Z-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">obsZ</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The two-sided p-value is:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The observed Z-value is: -0.303
The two-sided p-value is: 0.762
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Z-test for two proportions is conducted to test whether the difference between the two proportions is significant. 
$$ H_0: p_1=p_2 $$
$$ H_1: p_a\neq p_2$$</p>
<p>Based on the p-value, we fail to reject the null hypothesis at 95% confidence level and conclude that there isn't strong enough evidence that the two web pages promote sales differently.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Reasons-why-one-would-prefer-one-method-over-the-other">Reasons why one would prefer one method over the other<a class="anchor-link" href="#Reasons-why-one-would-prefer-one-method-over-the-other">&#182;</a></h4><h5 id="Method-(a)">Method (a)<a class="anchor-link" href="#Method-(a)">&#182;</a></h5><ul>
<li>Assumes the difference between the two proportions is random. </li>
<li>Thus, gives a probability over a binary decision. </li>
</ul>
<h5 id="Method-(b)">Method (b)<a class="anchor-link" href="#Method-(b)">&#182;</a></h5><ul>
<li>Assumes the <em>true</em> difference is fixed.</li>
<li>Does not require a prior distribution - the uniform distribution assumed for making a purchase may not be realistic.</li>
</ul>

</div>
</div>
</div>
    </div>
  </div>
</section>
  <script src="https://lihd1003.github.io/assets/js/vendor.js"></script>
  <script src="https://lihd1003.github.io/assets/js/app.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    $("table").addClass("table table-lined")
  </script>
</body>

 


</html>
